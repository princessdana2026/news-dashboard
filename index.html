<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ¯æ—¥æ–°é—» Â· å›½é™…å›½å†…ç§‘æŠ€å¿ƒç†</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { 
            font-family: 'Microsoft YaHei', 'PingFang SC', Helvetica, Arial, sans-serif; 
            background: #f0f2f5; 
            padding: 25px; 
        }
        .header {
            text-align: center;
            margin-bottom: 30px;
        }
        h1 { 
            color: #1e3c72; 
            font-size: 32px;
            font-weight: 600;
            margin-bottom: 8px;
        }
        .subhead {
            color: #6c757d;
            font-size: 15px;
            border-bottom: 2px solid #e9ecef;
            padding-bottom: 15px;
            margin-top: 5px;
        }
        .grid { 
            display: grid; 
            grid-template-columns: repeat(auto-fit, minmax(360px, 1fr)); 
            gap: 25px; 
            max-width: 1800px; 
            margin: 0 auto; 
        }
        .card { 
            background: white; 
            border-radius: 20px; 
            box-shadow: 0 10px 25px rgba(0,0,0,0.05); 
            overflow: hidden; 
            border: 1px solid #edf2f7;
            transition: transform 0.2s;
        }
        .card:hover {
            box-shadow: 0 15px 35px rgba(0,0,0,0.1);
        }
        .card-header { 
            background: linear-gradient(145deg, #1e3c72, #2a4a7a); 
            color: white; 
            padding: 18px 20px; 
            font-size: 19px; 
            font-weight: 600; 
            display: flex; 
            justify-content: space-between; 
            align-items: center; 
            letter-spacing: 0.5px;
        }
        .card-header button { 
            background: rgba(255,255,255,0.18); 
            border: 1px solid rgba(255,255,255,0.25); 
            color: white; 
            padding: 6px 16px; 
            border-radius: 40px; 
            cursor: pointer; 
            font-size: 13px; 
            font-weight: 500;
            transition: 0.25s;
            display: flex;
            align-items: center;
            gap: 5px;
        }
        .card-header button:hover { 
            background: rgba(255,255,255,0.3); 
            border-color: rgba(255,255,255,0.5);
        }
        .card-body { 
            padding: 20px; 
            height: 500px; 
            overflow-y: auto; 
            background: #fafcff;
            scrollbar-width: thin;
            scrollbar-color: #cbd5e0 #f1f5f9;
        }
        .card-body::-webkit-scrollbar {
            width: 6px;
        }
        .card-body::-webkit-scrollbar-track {
            background: #f1f5f9;
        }
        .card-body::-webkit-scrollbar-thumb {
            background: #cbd5e0;
            border-radius: 10px;
        }
        .news-item { 
            margin-bottom: 22px; 
            border-bottom: 1px solid #eef2f6; 
            padding-bottom: 18px; 
        }
        .news-item:last-child { 
            border-bottom: none; 
            margin-bottom: 0; 
            padding-bottom: 0; 
        }
        .news-title { 
            font-weight: 600; 
            color: #1a3a5f; 
            text-decoration: none; 
            font-size: 16px; 
            line-height: 1.5; 
            display: block;
            transition: color 0.15s;
        }
        .news-title:hover { 
            color: #0066cc; 
            text-decoration: underline; 
        }
        .news-meta { 
            font-size: 12.5px; 
            color: #5a6874; 
            margin-top: 10px; 
            display: flex; 
            align-items: center; 
            gap: 12px; 
            flex-wrap: wrap;
        }
        .source-tag { 
            background: #e9f0fa; 
            color: #1e3c72; 
            padding: 4px 14px; 
            border-radius: 30px; 
            font-size: 11.5px; 
            font-weight: 600; 
            letter-spacing: 0.3px;
        }
        .error-msg, .loading { 
            color: #5a6874; 
            background: #f8fafc; 
            padding: 18px; 
            border-radius: 14px; 
            text-align: center; 
            font-size: 14px; 
            border: 1px dashed #cbd5e0;
        }
        .loading {
            color: #1e3c72;
            background: #f0f7ff;
        }
        .feed-source-badge {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            margin-bottom: 15px;
            padding-bottom: 12px;
            border-bottom: 1px dashed #dce3eb;
            font-size: 12px;
            color: #4a5c6b;
        }
        .feed-item {
            background: #f0f4fa;
            padding: 4px 12px;
            border-radius: 30px;
            color: #2c3e50;
            font-size: 11px;
            font-weight: 500;
        }
    </style>
</head>
<body>
    <div class="header">
        <h1>ğŸ“° æ¯æ—¥æ–°é—» Â· å…¨æºèšåˆ</h1>
        <div class="subhead">äººæ°‘ç½‘ Â· æ–°åç¤¾ Â· æ¾æ¹ƒ Â· 36æ°ª Â· è™å—… Â· ä¸­ç§‘é™¢å¿ƒç†æ‰€ Â· è”åˆå›½ä¸­æ–‡ç½‘</div>
    </div>
    <div class="grid" id="app"></div>

    <script>
        // ---------- âœ… å››å¤§æ¿å— Â· å…¨éƒ¨ä½ è¦æ±‚çš„æ–°é—»æº ----------
        const SECTIONS = [
            {
                id: 'domestic',
                name: 'ğŸ‡¨ğŸ‡³ å›½å†…Â·æ—¶æ”¿',
                description: 'äººæ°‘ç½‘ + æ–°åç¤¾ + æ¾æ¹ƒ',
                feeds: [
                    { name: 'äººæ°‘ç½‘', url: 'http://www.people.com.cn/rss/politics.xml' },
                    { name: 'æ–°åç¤¾', url: 'http://www.xinhuanet.com/rss/china.xml' },
                    { name: 'æ¾æ¹ƒæ–°é—»', url: 'https://www.thepaper.cn/www/rss/breakingNews.xml' }
                ],
                dateOptions: { year: 'numeric', month: 'numeric', day: 'numeric', hour: '2-digit', minute: '2-digit', hour12: false }
            },
            {
                id: 'tech',
                name: 'ğŸ’» ç§‘æŠ€Â·å•†ä¸š',
                description: '36æ°ª + è™å—…ç½‘',
                feeds: [
                    { name: '36æ°ª', url: 'https://36kr.com/feed' },
                    { name: 'è™å—…ç½‘', url: 'https://www.huxiu.com/rss/0.xml' }
                ],
                dateOptions: { year: 'numeric', month: 'numeric', day: 'numeric', hour: '2-digit', minute: '2-digit', hour12: false }
            },
            {
                id: 'psych',
                name: 'ğŸ§  å¿ƒç†Â·è®¤çŸ¥',
                description: 'ä¸­ç§‘é™¢å¿ƒç†æ‰€ Â· å®˜æ–¹èµ„è®¯',
                feeds: [
                    { name: 'ä¸­ç§‘é™¢å¿ƒç†æ‰€', url: 'http://www.psych.cas.cn/rcjy/xsxx/rss.xml' }
                ],
                dateOptions: { year: 'numeric', month: 'numeric', day: 'numeric', hour: '2-digit', minute: '2-digit', hour12: false }
            },
            {
                id: 'intl',
                name: 'ğŸŒ å›½é™…Â·å…¨çƒ',
                description: 'è”åˆå›½æ–°é—» Â· ä¸­æ–‡ç‰ˆ',
                feeds: [
                    { name: 'è”åˆå›½æ–°é—»', url: 'https://news.un.org/feed/subscribe/zh/news/all/rss.xml' }
                ],
                dateOptions: { year: 'numeric', month: 'numeric', day: 'numeric', hour: '2-digit', minute: '2-digit', hour12: false }
            }
        ];

        // ---------- ä»£ç†æœåŠ¡ï¼ˆè§£å†³è·¨åŸŸï¼‰----------
        const PROXY = 'https://api.allorigins.win/get?url=';

        // ---------- æŠ“å–RSSå¹¶è§£æ ----------
        async function fetchRSS(feedUrl) {
            try {
                const response = await fetch(PROXY + encodeURIComponent(feedUrl));
                const data = await response.json();
                const parser = new DOMParser();
                return parser.parseFromString(data.contents, 'text/xml');
            } catch (e) {
                console.error('âŒ æŠ“å–å¤±è´¥:', feedUrl, e);
                return null;
            }
        }

        // ---------- ä»XMLæå–æ¡ç›® ----------
        function parseItems(xml, maxItems = 10) {
            if (!xml) return [];
            const items = Array.from(xml.querySelectorAll('item')).slice(0, maxItems);
            return items.map(item => ({
                title: item.querySelector('title')?.textContent?.trim() || 'æ— æ ‡é¢˜',
                link: item.querySelector('link')?.textContent?.trim() || '#',
                pubDate: item.querySelector('pubDate')?.textContent || item.querySelector('dc:date')?.textContent || '',
                description: item.querySelector('description')?.textContent?.replace(/<[^>]*>/g, '').slice(0, 60) || ''
            }));
        }

        // ---------- åŠ è½½å•ä¸ªæ¿å—ï¼ˆåˆå¹¶å¤šä¸ªfeedï¼‰----------
        async function loadSection(section) {
            const bodyEl = document.getElementById(`body-${section.id}`);
            if (bodyEl) {
                bodyEl.innerHTML = `<div class="loading">â³ æ­£åœ¨ä¸ºæ‚¨èšåˆ ${section.feeds.length} ä¸ªæ–°é—»æº...</div>`;
            }

            let allItems = [];
            
            // å¹¶å‘æŠ“å–è¯¥æ¿å—ä¸‹çš„æ‰€æœ‰RSSæº
            const feedPromises = section.feeds.map(async (feed) => {
                const xml = await fetchRSS(feed.url);
                const items = parseItems(xml, 8);  // æ¯ä¸ªæºå–8æ¡
                items.forEach(item => { 
                    item.sourceName = feed.name; 
                });
                return items;
            });

            const results = await Promise.allSettled(feedPromises);
            results.forEach(result => {
                if (result.status === 'fulfilled') {
                    allItems = allItems.concat(result.value);
                }
            });

            // å»é‡ï¼ˆç®€å•å»é‡ï¼šç›¸åŒæ ‡é¢˜åªä¿ç•™ä¸€æ¡ï¼‰
            const uniqueTitles = new Set();
            const uniqueItems = [];
            allItems.forEach(item => {
                if (!uniqueTitles.has(item.title) && item.title !== 'æ— æ ‡é¢˜') {
                    uniqueTitles.add(item.title);
                    uniqueItems.push(item);
                }
            });

            // æŒ‰æ—¶é—´æ’åºï¼ˆæœ€æ–°çš„åœ¨å‰é¢ï¼‰
            uniqueItems.sort((a, b) => {
                const dateA = new Date(a.pubDate || 0);
                const dateB = new Date(b.pubDate || 0);
                return dateB - dateA;
            });

            // å–å‰15æ¡
            renderSection(section, uniqueItems.slice(0, 15));
        }

        // ---------- æ¸²æŸ“æ¿å— ----------
        function renderSection(section, items) {
            const card = document.getElementById(`card-${section.id}`);
            if (!card) return;
            
            const bodyEl = document.getElementById(`body-${section.id}`);
            
            let html = '';
            
            // æ˜¾ç¤ºæœ¬æ¿å—åŒ…å«çš„æ–°é—»æº
            html += `<div class="feed-source-badge">`;
            section.feeds.forEach(feed => {
                html += `<span class="feed-item">ğŸ“Œ ${feed.name}</span>`;
            });
            html += `</div>`;

            if (items.length === 0) {
                html += `<div class="error-msg">
                            âš ï¸ æš‚æ— æ–°é—»ï¼Œè¯·ç‚¹å‡»ä¸Šæ–¹ã€Œåˆ·æ–°ã€æŒ‰é’®é‡è¯•
                        </div>`;
            } else {
                items.forEach(item => {
                    let date = 'æ—¶é—´æœªçŸ¥';
                    if (item.pubDate) {
                        try {
                            const d = new Date(item.pubDate);
                            date = d.toLocaleString('zh-CN', section.dateOptions);
                        } catch (e) {}
                    }
                    
                    html += `
                        <div class="news-item">
                            <a class="news-title" href="${item.link}" target="_blank" rel="noopener noreferrer">
                                ${item.title}
                            </a>
                            <div class="news-meta">
                                <span class="source-tag">${item.sourceName || section.feeds[0].name}</span>
                                <span>ğŸ•’ ${date}</span>
                            </div>
                        </div>
                    `;
                });
            }
            
            bodyEl.innerHTML = html;
        }

        // ---------- å…¨å±€åˆ·æ–°å‡½æ•° ----------
        window.refreshSection = async function(sectionId) {
            const section = SECTIONS.find(s => s.id === sectionId);
            if (section) {
                await loadSection(section);
            }
        };

        // ---------- åˆå§‹åŒ–é¡µé¢ï¼šæ„å»ºå¡ç‰‡å¹¶åŠ è½½æ•°æ® ----------
        window.addEventListener('DOMContentLoaded', async () => {
            const container = document.getElementById('app');
            container.innerHTML = '';

            // åˆ›å»ºå››ä¸ªå¡ç‰‡æ¡†æ¶
            SECTIONS.forEach(section => {
                const card = document.createElement('div');
                card.className = 'card';
                card.id = `card-${section.id}`;
                
                // å¤´éƒ¨ï¼ˆå¸¦åˆ·æ–°æŒ‰é’®ï¼‰
                const header = document.createElement('div');
                header.className = 'card-header';
                header.innerHTML = `
                    <span>${section.name}</span>
                    <button onclick="window.refreshSection('${section.id}')">
                        ğŸ”„ åˆ·æ–°
                    </button>
                `;
                
                // ä¸»ä½“ï¼ˆåŠ è½½ä¸­å ä½ï¼‰
                const body = document.createElement('div');
                body.className = 'card-body';
                body.id = `body-${section.id}`;
                body.innerHTML = `<div class="loading">â³ è·å–æ–°é—»ä¸­ï¼Œè¯·ç¨å...</div>`;
                
                card.appendChild(header);
                card.appendChild(body);
                container.appendChild(card);
            });

            // å¹¶è¡ŒåŠ è½½æ‰€æœ‰æ¿å—
            await Promise.all(SECTIONS.map(section => loadSection(section)));
        });
    </script>
</body>
</html>
