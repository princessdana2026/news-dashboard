<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ¯æ—¥æ–°é—» Â· ç§‘æŠ€å®æ—¶å¤´æ¡ç‰ˆ</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: 'Microsoft YaHei', sans-serif; background: #f0f2f5; padding: 25px; }
        h1 { text-align: center; color: #1e3c72; margin-bottom: 10px; font-size: 28px; }
        .sub { text-align: center; color: #6c757d; margin-bottom: 30px; font-size: 14px; }
        .grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(380px, 1fr)); gap: 25px; }
        .card { background: white; border-radius: 16px; box-shadow: 0 8px 20px rgba(0,0,0,0.06); overflow: hidden; }
        .card-header { background: #1e3c72; color: white; padding: 16px 20px; font-size: 18px; font-weight: 600; display: flex; justify-content: space-between; align-items: center; }
        .card-header button { background: rgba(255,255,255,0.2); border: 1px solid rgba(255,255,255,0.3); color: white; padding: 5px 16px; border-radius: 30px; cursor: pointer; }
        .card-header button:hover { background: rgba(255,255,255,0.35); }
        .card-body { padding: 20px; height: 600px; overflow-y: auto; background: #fafbfc; }
        .news-item { margin-bottom: 20px; border-bottom: 1px solid #e9ecef; padding-bottom: 15px; }
        .news-item:last-child { border-bottom: none; }
        .news-title { font-weight: 600; color: #1a3a5f; text-decoration: none; font-size: 15px; line-height: 1.5; display: block; }
        .news-title:hover { color: #0066cc; text-decoration: underline; }
        .news-meta { font-size: 12px; color: #6c757d; margin-top: 8px; display: flex; align-items: center; gap: 12px; }
        .source-tag { background: #e7f1ff; color: #1e3c72; padding: 3px 12px; border-radius: 30px; font-size: 11px; font-weight: 500; }
        .error-msg { color: #856404; background: #fff3cd; padding: 15px; border-radius: 10px; text-align: center; }
        .loading { color: #1e3c72; text-align: center; padding: 20px; }
    </style>
</head>
<body>
    <h1>ğŸ“° æ¯æ—¥æ–°é—» Â· ç§‘æŠ€å®æ—¶å¤´æ¡</h1>
    <div class="sub">âœ… ç§‘æŠ€ï¼šé¸Ÿå“¥ç¬”è®°Â·å¼€æºä¸­å›½ï¼ˆå®æ—¶æ›´æ–°ï¼‰ | å›½å†…ï¼šè”åˆæ—©æŠ¥Â·BBC | å›½é™…ï¼šè”åˆå›½Â·BBC | å¿ƒç†ï¼šPsychology Today</div>
    <div class="grid" id="app"></div>

    <script>
        // ---------- æ›´æ¢ä¸ºæœ€ç¨³å®šçš„ä»£ç† ----------
        const PROXY = 'https://cors-anywhere.herokuapp.com/';
        
        // ---------- å››å¤§æ¿å— Â· ç§‘æŠ€æ¢ä¸ºå®æ—¶æ›´æ–°æº ----------
        const SECTIONS = [
            {
                id: 'tech',
                name: 'ğŸ’» ç§‘æŠ€Â·å¤´æ¡',
                feeds: [
                    { name: 'é¸Ÿå“¥ç¬”è®°', url: 'https://www.niaogebiji.com/feed' },        // äº’è”ç½‘ç§‘æŠ€ï¼Œå®æ—¶æ›´æ–°
                    { name: 'å¼€æºä¸­å›½', url: 'https://www.oschina.net/news/rss' }         // æœ€æ–°æŠ€æœ¯åŠ¨æ€ï¼Œæ¯æ—¥æ•°åæ¡
                ]
            },
            {
                id: 'domestic',
                name: 'ğŸ‡¨ğŸ‡³ å›½å†…æ–°é—»',
                feeds: [
                    { name: 'è”åˆæ—©æŠ¥', url: 'https://www.zaobao.com.sg/rss/china.xml' },
                    { name: 'BBCä¸­æ–‡', url: 'https://feeds.bbci.co.uk/zhongwen/simp/china/rss.xml' }
                ]
            },
            {
                id: 'intl',
                name: 'ğŸŒ å›½é™…æ–°é—»',
                feeds: [
                    { name: 'è”åˆå›½æ–°é—»', url: 'https://news.un.org/feed/subscribe/zh/news/all/rss.xml' },
                    { name: 'BBCä¸­æ–‡å›½é™…', url: 'https://feeds.bbci.co.uk/zhongwen/simp/world/rss.xml' }
                ]
            },
            {
                id: 'psych',
                name: 'ğŸ§  å¿ƒç†å­¦',
                feeds: [
                    { name: 'Psychology Today', url: 'https://www.psychologytoday.com/feeds/rss' }
                ]
            }
        ];

        async function fetchRSS(feedUrl) {
            try {
                const res = await fetch(PROXY + feedUrl);
                const text = await res.text();
                const parser = new DOMParser();
                return parser.parseFromString(text, 'text/xml');
            } catch (e) {
                console.error('æŠ“å–å¤±è´¥:', feedUrl, e);
                return null;
            }
        }

        function parseItems(xml, max = 25) {  // æ”¹ä¸ºæœ€å¤š25æ¡
            if (!xml) return [];
            const items = Array.from(xml.querySelectorAll('item')).slice(0, max);
            return items.map(item => ({
                title: item.querySelector('title')?.textContent?.trim() || 'æ— æ ‡é¢˜',
                link: item.querySelector('link')?.textContent?.trim() || '#',
                pubDate: item.querySelector('pubDate')?.textContent || item.querySelector('dc:date')?.textContent || '',
            }));
        }

        async function loadSection(section) {
            const body = document.getElementById(`body-${section.id}`);
            if (body) body.innerHTML = `<div class="loading">â³ è·å–æœ€æ–° ${section.feeds.length} ä¸ªæº...</div>`;

            let allItems = [];
            for (const feed of section.feeds) {
                const xml = await fetchRSS(feed.url);
                const items = parseItems(xml, 20);  // æ¯ä¸ªæºå–20æ¡
                items.forEach(item => item.source = feed.name);
                allItems = allItems.concat(items);
            }
            
            // æŒ‰æ—¶é—´æ’åºï¼ˆæœ€æ–°çš„åœ¨æœ€å‰é¢ï¼‰
            allItems.sort((a, b) => new Date(b.pubDate) - new Date(a.pubDate));
            
            if (body) {
                if (allItems.length === 0) {
                    body.innerHTML = `<div class="error-msg">â³ æ­£åœ¨è¿æ¥æ–°é—»æºï¼Œè¯·ç‚¹åˆ·æ–°</div>`;
                } else {
                    let html = '';
                    allItems.slice(0, 20).forEach(item => {  // æ˜¾ç¤º20æ¡
                        let date = '';
                        try {
                            date = new Date(item.pubDate).toLocaleString('zh-CN', {
                                month: 'numeric', day: 'numeric', 
                                hour: '2-digit', minute: '2-digit'
                            });
                        } catch(e) {}
                        
                        html += `
                            <div class="news-item">
                                <a class="news-title" href="${item.link}" target="_blank">${item.title}</a>
                                <div class="news-meta">
                                    <span class="source-tag">ğŸ“Œ ${item.source || ''}</span>
                                    <span>ğŸ•’ ${date}</span>
                                </div>
                            </div>
                        `;
                    });
                    body.innerHTML = html;
                }
            }
        }

        window.refreshSection = function(sectionId) {
            const section = SECTIONS.find(s => s.id === sectionId);
            if (section) loadSection(section);
        };

        window.addEventListener('DOMContentLoaded', () => {
            const container = document.getElementById('app');
            SECTIONS.forEach(section => {
                const card = document.createElement('div');
                card.className = 'card';
                card.id = `card-${section.id}`;
                card.innerHTML = `
                    <div class="card-header">
                        <span>${section.name}</span>
                        <button onclick="window.refreshSection('${section.id}')">ğŸ”„ åˆ·æ–°</button>
                    </div>
                    <div class="card-body" id="body-${section.id}">
                        <div class="loading">â³ åŠ è½½ä¸­...</div>
                    </div>
                `;
                container.appendChild(card);
            });
            
            // é”™å¼€åŠ è½½ï¼Œé¿å…ä»£ç†é™æµ
            setTimeout(() => loadSection(SECTIONS[0]), 100);
            setTimeout(() => loadSection(SECTIONS[1]), 300);
            setTimeout(() => loadSection(SECTIONS[2]), 500);
            setTimeout(() => loadSection(SECTIONS[3]), 700);
        });
    </script>
</body>
</html>
