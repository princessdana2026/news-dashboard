<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <title>新闻仪表盘</title>
    <style>
        body {font-family: "Helvetica Neue", Helvetica, Arial, sans-serif; margin:0; padding:0; background:#f5f5f5;}
        header {background:#0066cc; color:#fff; padding:20px; text-align:center;}
        h1 {margin:0; font-size:2rem;}
        .container {display:grid; grid-template-columns:repeat(auto-fit, minmax(300px, 1fr)); gap:20px; padding:20px;}
        .card {background:#fff; border-radius:8px; box-shadow:0 2px 5px rgba(0,0,0,.1); overflow:hidden;}
        .card-header {background:#0066cc; color:#fff; padding:10px 15px; font-size:1.2rem;}
        .card-body {padding:15px; max-height:500px; overflow-y:auto;}
        .news-item {margin-bottom:15px; border-bottom:1px solid #e0e0e0; padding-bottom:10px;}
        .news-item:last-child {border:none; margin-bottom:0;}
        .news-title {font-weight:bold; font-size:1rem; color:#0066cc; text-decoration:none;}
        .news-title:hover {text-decoration:underline;}
        .news-meta {font-size:.85rem; color:#777; margin-top:5px;}
        .refresh-btn {background:#0066cc; color:#fff; border:none; border-radius:4px; padding:5px 10px; cursor:pointer; font-size:.9rem;}
        .refresh-btn:hover {background:#004c99;}
    </style>
</head>
<body>
<header>
    <h1>新闻仪表盘</h1>
</header>

<div class="container">
    <!-- 国内新闻 -->
    <section class="card" id="domestic-card">
        <div class="card-header">
            国内新闻
            <button class="refresh-btn" onclick="loadFeed('domestic')">刷新</button>
        </div>
        <div class="card-body" id="domestic-body"></div>
    </section>

    <!-- 科技新闻 -->
    <section class="card" id="tech-card">
        <div class="card-header">
            科技新闻
            <button class="refresh-btn" onclick="loadFeed('tech')">刷新</button>
        </div>
        <div class="card-body" id="tech-body"></div>
    </section>

    <!-- 心理新闻 -->
    <section class="card" id="psych-card">
        <div class="card-header">
            心理健康
            <button class="refresh-btn" onclick="loadFeed('psych')">刷新</button>
        </div>
        <div class="card-body" id="psych-body"></div>
    </section>

    <!-- 国际新闻 -->
    <section class="card" id="intl-card">
        <div class="card-header">
            国际新闻（联合国中文站）
            <button class="refresh-btn" onclick="loadFeed('intl')">刷新</button>
        </div>
        <div class="card-body" id="intl-body"></div>
    </section>
</div>

<script>
/* ---------- RSS 源配置 ---------- */
const RSS_FEEDS = {
    domestic: {
        // 新华社国内新闻
        url: 'http://www.xinhuanet.com/rss/china.xml',
        // 中文日期格式
        dateOptions: {year:'numeric', month:'numeric', day:'numeric', hour:'numeric', minute:'numeric'}
    },
    tech: {
        // 搜狐科技新闻
        url: 'http://news.sohu.com/rss/tech.xml',
        dateOptions: {year:'numeric', month:'numeric', day:'numeric', hour:'numeric', minute:'numeric'}
    },
    psych: {
        // 搜狐心理健康（如果该分类不存在，可换成其他中文心理频道）
        url: 'http://news.sohu.com/rss/psychology.xml',
        dateOptions: {year:'numeric', month:'numeric', day:'numeric', hour:'numeric', minute:'numeric'}
    },
    intl: {
        // 联合国中文站 RSS
        url: 'https://news.un.org/rss/chinese',
        dateOptions: {year:'numeric', month:'numeric', day:'numeric', hour:'numeric', minute:'numeric'}
    }
};

/* ---------- 获取并解析 RSS ---------- */
async function fetchRSS(feedUrl) {
    const proxy = 'https://api.allorigins.win/get?url=';
    const response = await fetch(proxy + encodeURIComponent(feedUrl));
    const data = await response.json();
    const parser = new DOMParser();
    const xml = parser.parseFromString(data.contents, "application/xml");
    return xml;
}

/* ---------- 渲染新闻 ---------- */
function renderItems(items, containerId, dateOptions) {
    const container = document.getElementById(containerId);
    container.innerHTML = ''; // 清空旧内容

    if (!items || items.length === 0) {
        container.innerHTML = '<p>暂无新闻</p>';
        return;
    }

    items.forEach(item => {
        const title = item.querySelector('title')?.textContent ?? '（无标题）';
        const link = item.querySelector('link')?.textContent ?? '#';
        const pubDate = item.querySelector('pubDate')?.textContent ?? '';
        const description = item.querySelector('description')?.textContent ?? '';

        // 日期转为中文格式
        const date = pubDate ? new Date(pubDate).toLocaleString('zh-CN', dateOptions) : '';

        const newsDiv = document.createElement('div');
        newsDiv.className = 'news-item';
        newsDiv.innerHTML = `
            <a class="news-title" href="${link}" target="_blank" rel="noopener">${title}</a>
            <div class="news-meta">${date}</div>
            <div class="news-desc">${description}</div>
        `;
        container.appendChild(newsDiv);
    });
}

/* ---------- 加载指定板块 ---------- */
async function loadFeed(section) {
    const feedInfo = RSS_FEEDS[section];
    if (!feedInfo) return;

    try {
        const xml = await fetchRSS(feedInfo.url);
        const items = Array.from(xml.querySelectorAll('item')).slice(0, 10); // 只取前 10 条
        renderItems(items, `${section}-body`, feedInfo.dateOptions);
    } catch (e) {
        console.error(e);
        document.getElementById(`${section}-body`).innerHTML = '<p>加载失败，请稍后重试</p>';
    }
}

/* ---------- 页面加载完成后自动刷新所有板块 ---------- */
window.addEventListener('DOMContentLoaded', () => {
    ['domestic', 'tech', 'psych', 'intl'].forEach(section => loadFeed(section));
});
</script>
</body>
</html>
